---
title: "Final Project"
author: "Joshua Firestone"
date: |
  `r format(Sys.time(), '%B %d, %Y')`
abstract: |
  For this project I am doubling up on a project for my Supply Chain
  Analytics course. It uses Boston housing data which is a fairly common
  dataset that is often used as a sample case [@housing]. For the class
  project our task was to utilize multiple models and methods that we
  have learned this semester to analyze the data. My portion was
  regression trees and random forests, so that will be all I include
  here. 
geometry: margin = 1in              
fontsize: 12pt 
bibliography: bibliography.bib 
biblio-style: authoryear               
urlcolor: blue                         
citecolor: black                       
linkcolor: magenta

output: 
  bookdown::pdf_document2:
    keep_tex: true
    latex_engine: xelatex
    number_sections: true
    toc: true
    fig_caption: true
    citation_package: biblatex
    includes:
      in_header:
        - preamble.tex
  bookdown::html_document2: default
  bookdown::word_document2:
    toc: true
---

```{r set options, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(
  echo=FALSE, include=FALSE,
  fig.align = "center",
  fig.width = 4, fig.height = 3, 
  out.width = "80%")
```

```{r libraries}
library(here)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(randomForest)
library(tree)
```

```{r read in data}
boston <- here("data", "Data_Boston.csv") %>% 
  read_csv()
```


# Body
Typing some sample text here. Now I want to insert a Tableau image. Let's see if it works! ![alt text goes here](/Users/pbasu/Desktop/PS811-Final-Project/images/tableau-test-02.png)

# Overview
typity typity type type

# Regression Trees
typity typity type type
```{r data setup}
set.seed(1234)
train_ind <- sample.int(n = nrow(boston), 
                        size = floor(.75*nrow(boston)), 
                        replace = FALSE)

training <- boston[train_ind, ]
test <- boston[-train_ind, ]

boston_tree <- rpart(target ~ CRIM + ZN + INDUS + CHAS + NOX + RM +
                       AGE + DIS + RAD + TAX + PTRATIO + B + 
                       LSTAT, data = training, method = "anova")
```

```{r cp table, include=TRUE, results=TRUE}
plotcp(boston_tree)
```
typity typity type type

```{r first tree, include=TRUE, results=TRUE}
tree_prune <- prune(boston_tree, cp = 0.035)
prp(tree_prune, extra = 1, box.col = "olivedrab3")
```
typity typity type type
```{r partition tree, include=TRUE, results=TRUE}
plot(boston$LSTAT, boston$RM, col = "olivedrab3", pch=20, xlab="LSTAT",ylab="RM")
partition.tree(prune.tree(tree(target ~ RM + LSTAT, data = training), best = 5), ordvars=c("LSTAT","RM"), add=TRUE, cex = 1.15)
```
typity typity type type
```{r second tree, include=TRUE, results=TRUE}
pdtree <- prune(boston_tree, cp=boston_tree$cptable[which.min(boston_tree$cptable[,"xerror"]),"CP"])
prp(pdtree, extra = 1, box.col = "olivedrab3")
```
typity typity type type
```{r evaluate tree performance}
tree_pred <- predict(pdtree, newdata = test)
RMSE_tree <- sqrt(mean((tree_pred - test$target)^2))
print(RMSE_tree)
```


# Random Forests
typity typity type type
```{rset up and test RF}
rf_boston <- randomForest(target ~ CRIM + ZN + INDUS + CHAS + NOX + RM +
                            AGE + DIS + RAD + TAX + PTRATIO + B + 
                            LSTAT, data = training, ntree = 1000, importance = TRUE)

rf_predict <- predict(rf_boston, test, type = "response")
rf_rmse <- sqrt(mean((rf_predict - test$target)^2))
print(rf_rmse)
importance(rf_boston)

boston_imp <- as.data.frame(importance(rf_boston))
boston_imp$variables <- row.names(boston_imp)
boston_imp[order(boston_imp$"%IncMSE", decreasing = "TRUE"), ]
```
typity typity type type
```{r importance plot, include=TRUE, results=TRUE}
varImpPlot(rf_boston, sort = TRUE)
```

